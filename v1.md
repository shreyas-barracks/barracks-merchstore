# Vulnerabilities in VulnCommerce

This document lists all the vulnerabilities present in the VulnCommerce application, along with their severity and steps to reproduce them.

## P1: Critical Vulnerabilities

### P1-01: Authentication Bypass via JWT
- **Vulnerability Code:** `VULN-A1B2C3`
- **Severity:** Critical (P1)
- **Location:** `backend/login/views.py` - LoginView class
- **URL:** `POST /auth/login/`
- **Description:** The application accepts a bypass token via the `X-Bypass-Token` header. Any token starting with `bypass_` will authenticate as any user whose email is provided, without requiring a valid password.
- **Reproduction Steps:**
  1. Send a POST request to `/auth/login/` with any valid email
  2. Include header `X-Bypass-Token: bypass_anything`
  3. Authentication succeeds without valid password
  4. Attacker gains access to any user account
  

### P1-02: Business Logic Flaw (Free Checkout)
- **Vulnerability Code:** `VULN-D4E5F6`
- **Severity:** Critical (P1)
- **Location:** `backend/order/views.py` - Checkout class
- **URL:** `POST /order/place/`
- **Description:** The checkout endpoint accepts a client-provided `checkout_amount` parameter that overrides the calculated order amount. An attacker can set this to 0 or any arbitrary value to get products for free or at a manipulated price.
- **Reproduction Steps:**
  1. Add items to cart
  2. Send checkout request with `{"checkout_amount": 0}` in the body
  3. Order is created with amount of 0 (free)
  4. Attacker can purchase items without payment
  

### P1-03: Email override using registration
- **Vulnerability Code:** `VULN-G7H8I9`
- **Severity:** Critical (P1)
- **Location:** `backend/login/serializers.py` - RegisterSerializer.create()
- **URL:** `POST /auth/register/`
- **Description:** The registration endpoint checks if an email already exists, but instead of rejecting the registration, it updates the existing user's name, phone number, and password. This allows account takeover of any user by registering with their email.
- **Reproduction Steps:**
  1. Identify a target user's email address
  2. Send POST to `/auth/register/` with victim's email and new password
  3. The victim's account password is changed to attacker's password
  4. Attacker can now login with the new password


## P2: High Severity Vulnerabilities

### P2-01: SQL Injection in filters
- **Vulnerability Code:** `VULN-J1K2L3`
- **Severity:** High (P2)
- **Location:** `backend/products/views.py` - AllProductsView class
- **URL:** `GET /product/all/?search=<payload>`
- **Description:** The product search functionality uses raw SQL queries with string concatenation instead of parameterized queries. The search parameter is directly inserted into the SQL query without sanitization, allowing SQL injection.
- **Exploitation:**
  ```
  GET /product/all/?search=test' UNION SELECT * FROM login_customuser--
  ```
  This can be used to extract sensitive data from the database.


### P2-02: Clickjacking on delete account page
- **Vulnerability Code:** `VULN-M4N5O6`
- **Severity:** High (P2)
- **Location:** `backend/backend/settings.py` - XFrameOptionsMiddleware disabled
- **URL:** `GET /auth/delete-account/`
- **Description:** The X-Frame-Options middleware is disabled in settings.py, allowing the delete account page to be embedded in an iframe on a malicious site. Combined with social engineering, this enables clickjacking attacks where users unknowingly delete their accounts.
- **Exploitation:**
  1. Create malicious page with hidden iframe of delete account endpoint
  2. Trick authenticated user into clicking
  3. User's account is deleted without their knowledge

### P2-03: Clickjacking on delete account page  
- **Vulnerability Code:** `VULN-P7Q8R9`
- **Severity:** High (P2)
- **Location:** `backend/login/views.py` - DeleteAccountView class
- **URL:** `GET /auth/delete-account/`
- **Description:** The delete account view explicitly returns HTML without setting X-Frame-Options header, making it vulnerable to clickjacking even if middleware were enabled. This is a duplicate finding demonstrating defense in depth failure.
- **Exploitation:**
  Same as P2-02 - clickjacking via iframe embedding


### P2-04: Stored Cross-Site Scripting (XSS) Via Products
- **Vulnerability Code:** `VULN-S1T2U3`
- **Severity:** High (P2)
- **Location:** `backend/products/views.py` - CreateProductUnauthenticated class
- **URL:** `POST /product/create/`
- **Description:** The unauthenticated product creation endpoint accepts product name and description without any HTML sanitization. When products are displayed to users, malicious JavaScript in the name or description fields will execute in their browsers.
- **Exploitation:**
  ```json
  POST /product/create/
  {
    "name": "<script>alert(document.cookie)</script>",
    "description": "<img src=x onerror=alert('XSS')>",
    "price": 100
  }
  ```

### P2-05: Unauthenticated Product Creation
- **Vulnerability Code:** `VULN-V4W5X6`
- **Severity:** High (P2)
- **Location:** `backend/products/views.py` - CreateProductUnauthenticated class
- **URL:** `POST /product/create/`
- **Description:** The product creation endpoint has no authentication requirement (`permission_classes = []`). Any anonymous user can create products in the system, leading to spam, malicious content injection, and catalog pollution.
- **Exploitation:**
  ```json
  POST /product/create/
  {
    "name": "Fake Product",
    "description": "Malicious description",
    "price": 0,
    "max_quantity": 999
  }
  ```


### P2-06: Unauthenticated Product Accepting Orders
- **Vulnerability Code:** `VULN-Y7Z8A9`
- **Severity:** High (P2)
- **Location:** `backend/products/views.py` - ToggleProductOrders class
- **URL:** `POST /product/toggle-orders/<product_id>/`
- **Description:** The endpoint to toggle whether a product accepts orders has no authentication. An attacker can disable ordering for all products, causing denial of service, or enable ordering for products that should be unavailable.
- **Exploitation:**
  ```
  POST /product/toggle-orders/1/
  ```
  No authentication required - toggles accept_orders status


### P2-07: Export CSV Injection
- **Vulnerability Code:** `VULN-B1C2D3`
- **Severity:** High (P2)
- **Location:** `backend/dashboard/views.py` - successful_order_csv function
- **URL:** `POST /successful_order_csv/<product_id>/`
- **Description:** The CSV export functionality directly writes user-supplied data (name, email, printing_name, etc.) into CSV files without sanitization. An attacker can inject CSV formulas (e.g., `=cmd|'/c calc'!A1`) that execute when the CSV is opened in Excel or other spreadsheet applications.
- **Exploitation:**
  1. Register with name: `=cmd|'/c calc'!A1`
  2. Place order
  3. Admin exports CSV
  4. When opened in Excel, calculator launches (code execution)


## P3: Medium Severity Vulnerabilities

### P3-01: Stored Cross-Site Scripting (XSS) Via Registration
- **Vulnerability Code:** `VULN-E4F5G6`
- **Severity:** Medium (P3)
- **Location:** `backend/login/serializers.py` - RegisterSerializer.create()
- **URL:** `POST /auth/register/`
- **Description:** The registration form accepts user names without HTML sanitization. When the name is displayed in the dashboard or other parts of the application, malicious JavaScript can execute in admin or other users' browsers.
- **Reproduction Steps:**
  1. Register with name: `<script>alert('XSS')</script>`
  2. When admin views user list or orders, XSS executes
  3. Can be used to steal admin session tokens



### P3-02: Mass Assignment Vulnerability
- **Vulnerability Code:** `VULN-H7I8J9`
- **Severity:** Medium (P3)
- **Location:** `backend/products/views.py` - UpdateProductMassAssignment class
- **URL:** `POST /product/update/<product_id>/`
- **Description:** The product update endpoint accepts any field from the request body and applies it to the product model using `setattr()`. An attacker can modify sensitive fields like `price`, `is_visible`, `accept_orders`, etc. that should be restricted.
- **Reproduction Steps:**
  1. Authenticate as any user
  2. POST to `/product/update/1/` with `{"price": 0, "is_visible": false}`
  3. Product price is changed to 0 and made invisible

### P3-03: Insecure Direct Object Reference (IDOR) to Edit User Cart
- **Vulnerability Code:** `VULN-K1L2M3`
- **Severity:** Medium (P3)
- **Location:** `backend/products/views.py` - UpdateCartIDOR class
- **URL:** `POST /cart/update/<user_id>/`
- **Description:** The cart update endpoint accepts a `user_id` parameter and allows any authenticated user to modify another user's cart. There is no check to verify if the authenticated user is the owner of the cart.
- **Reproduction Steps:**
  1. Authenticate as user A
  2. Identify user B's user_id (e.g., from user listing)
  3. POST to `/cart/update/<user_b_id>/` with cart modifications
  4. User B's cart is modified by user A


### P3-04: Sensitive Data Exposure (Hardcoded Django Secrets)
- **Vulnerability Code:** `VULN-N4O5P6`
- **Severity:** Medium (P3)
- **Location:** `backend/backend/settings.py`
- **URL:** N/A (source code)
- **Description:** The Django SECRET_KEY is hardcoded in settings.py instead of being loaded from environment variables. This key is used for cryptographic signing and should never be exposed. With this key, an attacker can forge session tokens and other signed data.
- **Reproduction Steps:**
  1. View settings.py source code
  2. SECRET_KEY = "django-insecure-h@rdC0d3d_S3cr3t_K3y_2024_V3ry_Uns3cur3!!!"
  3. Use this key to forge Django session tokens


### P3-05: User Information Disclosure
- **Vulnerability Code:** `VULN-Q7R8S9`
- **Severity:** Medium (P3)
- **Location:** `backend/login/views.py` - UserListView class
- **URL:** `GET /auth/users/list/`
- **Description:** An unauthenticated endpoint exposes the complete list of all users including their names, emails, phone numbers, positions, and profile pictures. This information can be used for targeted attacks, social engineering, or spam.
- **Reproduction Steps:**
  1. Send GET request to `/auth/users/list/` without authentication
  2. Receive JSON array with all user information
  3. No authorization check performed


### P3-06: Business Logic Flaw (Price Manipulation)
- **Vulnerability Code:** `VULN-T1U2V3`
- **Severity:** Medium (P3)
- **Location:** `backend/products/views.py` - UpdateCart class
- **URL:** `POST /cart/update/`
- **Description:** The cart update endpoint accepts a `price` parameter from the client and updates the product's actual price in the database. An attacker can set any product's price to 0 or a minimal amount before checkout.
- **Reproduction Steps:**
  1. Add product to cart
  2. POST to `/cart/update/` with cart_items including `{"id": <cart_item_id>, "quantity": 1, "price": 0}`
  3. Product price in database is updated to 0
  4. Checkout at the manipulated price


### P3-07: Rate Limit Bypass - Discount Code Brute Force
- **Vulnerability Code:** `VULN-W4X5Y6`
- **Severity:** Medium (P3)
- **Location:** `backend/order/views.py` - CheckDiscountUnlimited class
- **URL:** `POST /discount/check-unlimited/`
- **Description:** The discount code validation endpoint has no rate limiting and no authentication requirement. An attacker can brute force discount codes by trying thousands of combinations until valid codes are discovered.
- **Reproduction Steps:**
  1. Script automated requests to `/discount/check-unlimited/`
  2. Try common patterns: SAVE10, SAVE20, WELCOME, etc.
  3. When valid code found, response includes discount percentage
  4. No rate limiting blocks the attack

### P3-08: No CSRF Protection
- **Vulnerability Code:** `VULN-Z7A8B9`
- **Severity:** Medium (P3)
- **Location:** `backend/backend/settings.py` - MIDDLEWARE
- **URL:** All state-changing endpoints
- **Description:** The CSRF middleware is completely disabled in settings.py. This allows attackers to forge requests from victims' browsers to perform unauthorized actions like placing orders, deleting accounts, or modifying data.
- **Reproduction Steps:**
  1. Create malicious HTML page with form targeting any endpoint
  2. Trick authenticated user to visit page
  3. Form auto-submits, performing action as the victim
  4. No CSRF token validation occurs

### P3-09: Open Redirect
- **Vulnerability Code:** `VULN-C1D2E3`
- **Severity:** Medium (P3)
- **Location:** `backend/order/views.py` - OpenRedirectView class
- **URL:** `GET /redirect/?url=<malicious_url>` or `POST /redirect/`
- **Description:** The redirect endpoint accepts a URL parameter and redirects to it without any validation. An attacker can craft links that appear to be from the legitimate domain but redirect to phishing sites or malware.
- **Reproduction Steps:**
  1. Craft URL: `https://vulncommerce.com/redirect/?url=https://evil.com/phishing`
  2. Send link to victims
  3. Users trust the vulncommerce.com domain
  4. Automatically redirected to malicious site

### P3-10: Path Traversal on Profile Picture Upload
- **Vulnerability Code:** `VULN-F4G5H6`
- **Severity:** Medium (P3)
- **Location:** `backend/login/views.py` - ProfilePictureUploadView class
- **URL:** `POST /auth/profile-picture/upload/`
- **Description:** The profile picture upload accepts a `filename` parameter that is used directly in file path construction without sanitization. An attacker can use path traversal sequences like `../../` to write files outside the intended directory or overwrite system files.
- **Reproduction Steps:**
  1. Authenticate as any user
  2. POST to `/auth/profile-picture/upload/` with `{"filename": "../../../etc/passwd", "profile_url": "malicious"}`
  3. Path traversal allows writing to arbitrary locations
  4. Response leaks internal file paths


### P3-11: File Upload on Product Picture - No Validation
- **Vulnerability Code:** `VULN-I7J8K9`
- **Severity:** Medium (P3)
- **Location:** `backend/login/views.py` - ProfilePictureUploadView class
- **URL:** `POST /auth/profile-picture/upload/`
- **Description:** The file upload functionality in profile picture upload has no validation on file type, size, or content. An attacker can upload executable files, PHP shells, or extremely large files to cause denial of service or achieve remote code execution if the upload directory is web-accessible.
- **Reproduction Steps:**
  1. Authenticate as any user
  2. POST malicious file with any extension (e.g., .php, .exe)
  3. No content-type validation performed
  4. File is accepted and stored

### P3-12: Insecure Password Change using Forgot Password
- **Vulnerability Code:** `VULN-L1M2N3`
- **Severity:** Medium (P3)
- **Location:** `backend/login/views.py` - ChangePasswordView class
- **URL:** `POST /auth/change-password/`
- **Description:** The password change endpoint requires only an email address and new password. There is no authentication requirement, no verification of the old password, and no email verification token. An attacker who knows a user's email can change their password without any authorization.
- **Reproduction Steps:**
  1. Identify victim's email address (from user listing endpoint)
  2. POST to `/auth/change-password/` with `{"email": "victim@example.com", "new_password": "hacked123"}`
  3. Password is changed without any verification
  4. Attacker can now login with new password


### P3-13: Broken Access Control - Update Any User Profile
- **Vulnerability Code:** `VULN-A2B3C4`
- **Severity:** Medium (P3)
- **Location:** `backend/login/views.py` - UpdateUserProfile class
- **URL:** `POST /auth/user/update/<user_id>/`
- **Description:** Any authenticated user can update any other user's profile including sensitive fields like `position`, `is_admin`, and `is_staff`. This allows privilege escalation where a regular user can make themselves an administrator.
- **Reproduction Steps:**
  1. Authenticate as any regular user
  2. POST to `/auth/user/update/1/` with `{"is_admin": true, "is_staff": true, "position": "admin"}`
  3. Target user (including yourself) is now an admin
  4. No authorization check is performed


### P3-14: Admin Impersonation without Authorization
- **Vulnerability Code:** `VULN-D5E6F7`
- **Severity:** Medium (P3)
- **Location:** `backend/login/views.py` - AdminImpersonation class
- **URL:** `POST /auth/admin/impersonate/<user_id>/`
- **Description:** The impersonation endpoint only checks if a user is authenticated, not if they have admin privileges. Any authenticated user can impersonate any other user and receive their authentication token, allowing complete account takeover.
- **Reproduction Steps:**
  1. Authenticate as any regular user
  2. POST to `/auth/admin/impersonate/1/` (admin user ID)
  3. Receive admin's authentication token
  4. Use token to perform actions as the admin


### P3-15: IDOR - View Any User's Order Details
- **Vulnerability Code:** `VULN-G8H9I1`
- **Severity:** Medium (P3)
- **Location:** `backend/order/views.py` - ViewAnyOrder class
- **URL:** `GET /order/view-any/<order_id>/`
- **Description:** The order viewing endpoint does not verify that the authenticated user owns the order being accessed. Any authenticated user can view any other user's order details including personal information, items purchased, and payment amounts.
- **Reproduction Steps:**
  1. Authenticate as any user
  2. Enumerate order IDs (e.g., Barracks_order_100000 to Barracks_order_999999)
  3. GET `/order/view-any/Barracks_order_123456/`
  4. Receive full order details including victim's email, phone, name, and purchase details


## P4: Low Severity Vulnerabilities

### P4-01: Missing Security Headers
- **Vulnerability Code:** `VULN-O4P5Q6`
- **Severity:** Low (P4)
- **Location:** `backend/backend/settings.py`
- **URL:** All pages
- **Description:** The application does not set recommended security headers. Specifically, `SECURE_CONTENT_TYPE_NOSNIFF` and `SECURE_BROWSER_XSS_FILTER` are disabled, and `X_FRAME_OPTIONS` is set to `ALLOWALL`. The absence of these headers can expose the application to certain types of attacks in browsers.
- **Reproduction Steps:**
  1. Inspect the HTTP response headers of any page in the application
  2. The `X-Content-Type-Options: nosniff` header is missing
  3. The `X-XSS-Protection: 1; mode=block` header is missing  
  4. The `X-Frame-Options` is set to ALLOWALL instead of DENY/SAMEORIGIN

### P4-02: Username/Email Enumeration
- **Vulnerability Code:** `VULN-R7S8T9`
- **Severity:** Low (P4)
- **CWE:** CWE-203: Observable Discrepancy
- **Location:** `backend/login/views.py` - LoginView class
- **URL:** `POST /auth/login/`
- **Description:** The login endpoint returns different error messages depending on whether an email exists ("Invalid password") or doesn't exist ("Email does not exist"). This allows an attacker to enumerate valid email addresses in the system.
- **Reproduction Steps:**
  1. POST to `/auth/login/` with non-existent email
  2. Receive error: "Email does not exist"
  3. POST with valid email and wrong password
  4. Receive error: "Invalid password"
  5. Different messages allow email enumeration

### P4-03: Debug Mode Enabled
- **Vulnerability Code:** `VULN-U1V2W3`
- **Severity:** Low (P4)
- **CWE:** CWE-489: Active Debug Code
- **Location:** `backend/backend/settings.py`
- **URL:** All pages (on error)
- **Description:** Django DEBUG mode is set to True in settings.py. This exposes detailed error messages, stack traces, environment variables, and SQL queries when errors occur. This information aids attackers in understanding the application's internals and identifying vulnerabilities.
- **Reproduction Steps:**
  1. Trigger an error (e.g., access non-existent page)
  2. Django returns detailed debug page with:
     - Full stack trace
     - Environment variables
     - SQL queries
     - Filesystem paths
     - Installed apps and settings

### P4-04: Session Cookie without HttpOnly Flag
- **Vulnerability Code:** `VULN-X4Y5Z6`
- **Severity:** Low (P4)
- **CWE:** CWE-1004: Sensitive Cookie Without 'HttpOnly' Flag
- **Location:** `backend/backend/settings.py`
- **URL:** All authenticated pages
- **Description:** The session cookies are not configured with the `HttpOnly` flag (`SESSION_COOKIE_HTTPONLY = False`). This makes session cookies accessible to client-side JavaScript. If combined with an XSS vulnerability, an attacker can steal session cookies and hijack user sessions.
- **Reproduction Steps:**
  1. Log in to the application
  2. Open browser developer console
  3. Type `document.cookie` and press Enter
  4. Session cookie value is visible in the output
  5. Combined with XSS vulnerabilities, session can be stolen


### P4-05: Weak Password Policy
- **Vulnerability Code:** `VULN-J2K3L4`
- **Severity:** Low (P4)
- **CWE:** CWE-521: Weak Password Requirements
- **Location:** `backend/backend/settings.py`
- **URL:** `POST /auth/register/`
- **Description:** All Django password validators are completely disabled (`AUTH_PASSWORD_VALIDATORS = []`). Users can register with extremely weak passwords like "1", "password", or "123456", making accounts vulnerable to brute force and credential stuffing attacks.
- **Reproduction Steps:**
  1. POST to `/auth/register/` with password: "1"
  2. Registration succeeds with no validation
  3. Users can set passwords that are:
     - Single character
     - Common passwords (password, 123456)
     - Same as username/email
     - All numeric

